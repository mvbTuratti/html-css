<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="static/admin.css">
    <title>Administração</title>
</head>
<body>
    <div class="t-header">
        <svg width="204" height="75" viewBox="0 -50 320 290"><g id="SvgjsG1290" featurekey="UFHKJ9-0" transform="matrix(2.1239539196374344,0,0,2.1239539196374344,-56.19769598187172,-10.683488661399561)" fill="#fd7014"><path xmlns="http://www.w3.org/2000/svg" fill="#fd7014" d="M73.541,30.57c0-6.539-2.576-16.567-6.41-24.953L66.863,5.03H33.137l-0.268,0.586  c-3.834,8.387-6.41,18.415-6.41,24.953c0,12.178,9.291,22.226,21.156,23.424l0.531,34.083c-4.578,0.566-8.51,3.194-10.854,6.922  h25.414c-2.344-3.729-6.275-6.357-10.852-6.922l0.527-34.083C64.248,52.796,73.541,42.748,73.541,30.57z M28.467,30.57  c0-6.028,2.438-15.617,5.963-23.532H65.57c3.525,7.913,5.963,17.502,5.963,23.532c0,11.875-9.66,21.537-21.533,21.537  S28.467,42.445,28.467,30.57z"></path><path xmlns="http://www.w3.org/2000/svg" fill="#fd7014" d="M69.451,32.727c0.225-2.374,0.111-3.958-0.283-7.124H31.084c-0.531,2.657-0.65,4.04-0.65,6.05  c0,9.528,10.072,18.811,19.594,18.811C59.547,50.463,68.885,42.227,69.451,32.727z"></path></g><g id="SvgjsG1291" featurekey="XAPJzK-0" transform="matrix(3.699856638741272,0,0,3.699856638741272,116.32989113118491,47.87485722975803)" fill="#111111"><path d="M6.5 6.42 l2.08 12.7 c0.16 1 -2.1 1.1 -2.22 0.38 l-0.4 -2.4 l-2.34 0 l-0.4 2.4 c-0.1 0.6 -2.38 0.62 -2.22 -0.38 l2.1 -12.7 c0.1 -0.6 3.32 -0.54 3.4 0 z M5.58 14.84 l-0.78 -4.78 l-0.8 4.78 l1.58 0 z M12.18 6 l2.7 0 c3.34 0 3.44 14 0.2 14 l-2.84 0 c-1.26 0 -1.26 0 -1.26 -1.1 l0 -11.8 c0 -1.08 0 -1.08 1.2 -1.1 z M14.06 8.26 l-0.02 0 c-0.8 0 -0.8 0 -0.8 0.76 l0 7.96 c0 0.74 0 0.74 0.84 0.74 l0.12 0 c1.3 0 1.24 -9.46 -0.14 -9.46 z M21.44 6 l2.7 0 c3.34 0 3.44 14 0.2 14 l-2.84 0 c-1.26 0 -1.26 0 -1.26 -1.1 l0 -11.8 c0 -1.08 0 -1.08 1.2 -1.1 z M23.32 8.26 l-0.02 0 c-0.8 0 -0.8 0 -0.8 0.76 l0 7.96 c0 0.74 0 0.74 0.84 0.74 l0.12 0 c1.3 0 1.24 -9.46 -0.14 -9.46 z M31.78 17.72 l2.86 0 c0.6 0 0.6 2.28 0 2.28 l-3.86 0 c-1.28 0 -1.28 0 -1.28 -1.08 l0 -11.84 c0 -1.08 0 -1.08 1.22 -1.1 l3.9 0.02 c0.6 0 0.6 2.28 0 2.28 l-2.84 0 l0 3.64 l2 0 c0.6 0 0.6 2.3 0 2.3 l-2 0 l0 3.5 z M45.06 13.68 l0 2.02 c0 0.58 0.1 1.86 -0.44 2.82 c-0.62 1.1 -1.8 1.42 -2.9 1.48 c-1.08 0.06 -2.1 -0.34 -2.86 -1.1 c-0.8 -0.76 -0.92 -1.72 -0.96 -2.44 l0 -0.04 l0 -6.84 l0 -0.04 c0.04 -0.72 0.16 -1.68 0.96 -2.44 c0.76 -0.76 1.78 -1.16 2.86 -1.1 c2.32 0.12 3.24 1.54 3.24 3.86 c0 0.52 -2.18 0.6 -2.18 -0.08 c0 -1.56 -0.92 -1.64 -1.86 -1.38 c-0.62 0.28 -0.74 1 -0.74 1.52 l0 6.18 c0.02 0.5 0.08 1.22 0.7 1.5 c0.48 0.16 1.94 0.4 2.06 -0.8 c0.04 -0.18 0.02 -0.48 0.02 -0.7 l-0.02 -1.24 l-0.88 0 c-0.6 0 -0.6 -2.3 0 -2.3 l2.02 0 c0.98 0 0.98 0 0.98 1.12 z M52.96 6.42 l2.08 12.7 c0.16 1 -2.1 1.1 -2.22 0.38 l-0.4 -2.4 l-2.34 0 l-0.4 2.4 c-0.1 0.6 -2.38 0.62 -2.22 -0.38 l2.1 -12.7 c0.1 -0.6 3.32 -0.54 3.4 0 z M52.04 14.84 l-0.78 -4.78 l-0.8 4.78 l1.58 0 z"></path></g></svg>
    </div>
    <div class="wrapper">
        <h2>CRUD</h2>
        <div class="body">
            <div class="operation">
                <select name="op" id="op" onchange="changeControl(this.value)">
                    <option value="listar-categorias">Listar Categorias</option>
                    <option value="listar-produtos">Listar Produtos</option>
                    <option value="criar-categoria">Criar Categorias</option>
                    <option value="criar-produto">Criar Produto</option>
                    <option value="alterar-categoria">Alterar Categoria</option>
                    <option value="alterar-produto">Alterar Produto</option>
                    <option value="deletar-categoria">Deletar Categoria</option>
                    <option value="deletar-produto">Deletar Produto</option>
                </select>
            </div>
            <div class="body-results">
                <div class="categorias">
                </div>
            </div>
        </div>
    </div>
    
</body>
    <script>
        const path = "http://loja.buiar.com/?key=e257vc";
        document.getElementById("op").selectedIndex = "0"
        getCategorias();
        function getCategorias() {
            let url = path + "&f=json&c=categoria&t=listar";
            fetch(url).then(r => r.json()).then(d => constructCards(d.dados));
        }

        function getProdutos() {
            let urlprod = path + "&f=json&c=produto&t=listar";
            let urlcat = path + "&f=json&c=categoria&t=listar";
            fetch(urlcat).then(resp => resp.json()).then(
                data => {
                    const dados = data.dados;
                    fetch(urlprod).then(r => r.json()).then(d => {
                        constructCards(d.dados, dados);
                    })
                }
            );
        }

        function constructCards(jsonCards, jsonCategories = null) {
            cleanUpCanvas();
            jsonCards = jsonCards || [];
            const catgs = document.getElementsByClassName("categorias")[0];
            while (catgs.firstChild) {
                catgs.removeChild(catgs.lastChild);
            }
            jsonCards.forEach(element => {
                if (jsonCategories){
                    createProductCard(jsonCategories, element, catgs);
                } else{
                    createCard(element, catgs);
                }
            });
            catgs.style.display = "flex";
        }

        function changeControl(param) {
            switch (param) {
                case "listar-categorias":
                    getCategorias();
                    break;
                case "listar-produtos":
                    getProdutos();
                    break;
                default:
                    break;
            }
        }

        function createCard(element, catgs) {
            let card = document.createElement('div');
            card.classList.add("cards");
            let id = document.createElement('div');
            id.classList.add("id");
            id.innerHTML = `<b>${element.id}</b>`
            card.appendChild(id);
            let nome = document.createElement('div');
            nome.classList.add("nome");
            nome.innerHTML = `${element.nome}`
            card.appendChild(nome);
            catgs.appendChild(card);
        }

        function createProductCard(categorias, elemento, div){
            let divs = []
            let card = document.createElement('div');
            card.classList.add("cards");
            let id = document.createElement('div');
            id.classList.add("id");
            id.innerHTML = `<b>${elemento.id}</b>`
            divs.push(id);
            let dimg = document.createElement('div');
            dimg.classList.add("images");
            let img = new Image(50,50);
            img.src = elemento.imagem;
            img.alt = `Imagem do produto: ${elemento.nome}`;
            dimg.appendChild(img);
            divs.push(dimg);
            let nome = document.createElement('div');
            nome.classList.add("products");
            nome.innerHTML = `${elemento.nome}`
            divs.push(nome);
            categorias.forEach(c => {
                if (c.id === elemento.categoria){
                    let cat = document.createElement('div');
                    cat.classList.add("products");
                    cat.innerHTML = `Categoria - ${c.nome}`
                    divs.push(cat);
                    
                }
            })
            let preco = document.createElement('div');
            preco.classList.add("products");
            let money = parseFloat(elemento.preco).toLocaleString('pt-BR', {
                            style: 'currency',
                            currency: 'BRL',
                        })
            preco.innerHTML = `Preço - ${money}`;
            divs.push(preco);
            let peso = document.createElement('div');
            peso.classList.add("products");
            peso.innerHTML = `Peso - ${elemento.peso}kg`
            divs.push(peso);
            divs.forEach(d => card.appendChild(d));
            div.appendChild(card);
        }


        function cleanUpCanvas() {
            const catgs = document.getElementsByClassName("body-results")[0]
            const children = catgs.children;
            for (let index = 0; index < children.length; index++) {
                const element = children[index];
                element.style.display = "none";
            }
        }

    </script>
</html>